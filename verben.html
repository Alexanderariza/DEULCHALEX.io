<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DEULCHALEX - Verbotrainer</title>
    <style>
        /* ... (mantén todos los estilos anteriores, solo añade los nuevos al final) ... */
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #e74c3c;
            --success: #27ae60;
            --warning: #f39c12;
            --purple: #9b59b6;
            --orange: #e67e22;
            --teal: #1abc9c;
            
            --bg-gradient-start: #1a1a2e;
            --bg-gradient-end: #16213e;
            --card-bg: rgba(255,255,255,0.05);
            --text-primary: #ecf0f1;
            --text-secondary: #bdc3c7;
            --border-color: rgba(255,255,255,0.1);
            --header-bg: rgba(0,0,0,0.3);
            --table-header-bg: var(--primary);
            --table-row-even: rgba(255,255,255,0.02);
            --verb-card-bg: rgba(255,255,255,0.03);
        }

        .light-theme {
            --bg-gradient-start: #f5f7fa;
            --bg-gradient-end: #c3cfe2;
            --card-bg: white;
            --text-primary: #2c3e50;
            --text-secondary: #34495e;
            --border-color: #ddd;
            --header-bg: rgba(255,255,255,0.3);
            --table-header-bg: var(--primary);
            --table-row-even: #f8f9fa;
            --verb-card-bg: #f8f9fa;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { background: linear-gradient(135deg, var(--bg-gradient-start) 0%, var(--bg-gradient-end) 100%); color: var(--text-primary); min-height: 100vh; line-height: 1.6; transition: background 0.3s, color 0.3s; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }

        /* Header */
        header { background: var(--header-bg); color: var(--text-primary); padding: 30px 20px; border-radius: 20px; margin-bottom: 40px; border-left: 5px solid var(--secondary); position: relative; overflow: hidden; backdrop-filter: blur(5px); }
        header::before { content: ""; position: absolute; top: 0; left: 0; right: 0; height: 5px; background: linear-gradient(90deg, var(--secondary), var(--accent), var(--success)); }
        .header-content { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 20px; }
        h1 { font-size: 2.5rem; margin-bottom: 10px; background: linear-gradient(90deg, var(--secondary), var(--accent)); -webkit-background-clip: text; background-clip: text; color: transparent; }
        .subtitle { color: var(--text-secondary); font-size: 1.1rem; max-width: 800px; }

        /* Botones icono */
        .btn-icon { width: 48px; height: 48px; border-radius: 50%; background: rgba(255, 255, 255, 0.1); border: 1px solid var(--border-color); color: var(--text-primary); display: inline-flex; align-items: center; justify-content: center; font-size: 1.5rem; cursor: pointer; transition: all 0.3s ease; text-decoration: none; backdrop-filter: blur(5px); }
        .btn-icon:hover { background: var(--secondary); color: white; transform: translateY(-3px); border-color: transparent; }

        /* Navegación */
        .theory-nav { display: flex; flex-wrap: wrap; gap: 15px; margin-bottom: 40px; justify-content: center; }
        .nav-btn { background: var(--card-bg); padding: 15px 25px; border-radius: 12px; text-decoration: none; color: var(--text-primary); font-weight: 600; transition: all 0.3s; border: 1px solid var(--border-color); border-left: 5px solid; display: flex; align-items: center; gap: 10px; backdrop-filter: blur(5px); }
        .nav-btn:hover { transform: translateY(-5px); border-color: var(--secondary); }
        .nav-1 { border-left-color: var(--secondary); } .nav-2 { border-left-color: var(--accent); } .nav-3 { border-left-color: var(--success); } .nav-4 { border-left-color: var(--warning); } .nav-5 { border-left-color: var(--purple); } .nav-6 { border-left-color: var(--orange); } .nav-7 { border-left-color: var(--teal); } .nav-8 { border-left-color: var(--primary); } .nav-9 { border-left-color: var(--accent); } .nav-10 { border-left-color: var(--success); }

        /* Secciones */
        .section { background: var(--card-bg); border-radius: 18px; padding: 35px; margin-bottom: 35px; border: 1px solid var(--border-color); border-top: 6px solid; backdrop-filter: blur(5px); }
        .section-1 { border-top-color: var(--secondary); } .section-2 { border-top-color: var(--accent); } .section-3 { border-top-color: var(--success); } .section-4 { border-top-color: var(--warning); } .section-5 { border-top-color: var(--purple); } .section-6 { border-top-color: var(--orange); } .section-7 { border-top-color: var(--teal); } .section-8 { border-top-color: var(--primary); } .section-9 { border-top-color: var(--accent); } .section-10 { border-top-color: var(--success); }
        .section-title { font-size: 1.8rem; color: var(--text-primary); margin-bottom: 25px; display: flex; align-items: center; gap: 15px; padding-bottom: 15px; border-bottom: 2px solid var(--border-color); }
        .section-title i { font-size: 2rem; }

        /* Tablas */
        .table-container { overflow-x: auto; margin: 30px 0; }
        .conjugation-table { width: 100%; border-collapse: collapse; border-radius: 12px; overflow: hidden; background: var(--card-bg); }
        .conjugation-table th { background: var(--table-header-bg); color: white; padding: 15px; text-align: center; font-weight: 700; }
        .conjugation-table td { padding: 12px; text-align: center; border: 1px solid var(--border-color); }
        .conjugation-table tr:nth-child(even) { background-color: var(--table-row-even); }
        .highlight { background: rgba(52,152,219,0.2); padding: 3px 6px; border-radius: 4px; font-weight: 700; }

        /* Cajas teóricas */
        .rule-box { background: rgba(255,255,255,0.03); border-radius: 12px; padding: 20px; margin: 20px 0; border: 1px solid var(--border-color); }
        .rule-title { font-weight: 800; color: var(--accent); margin-bottom: 10px; display: flex; align-items: center; gap: 10px; }
        .mnemonic-box { background: rgba(243,156,18,0.15); border-radius: 15px; padding: 25px; margin: 30px 0; border-left: 6px solid var(--warning); }
        .tip-box { background: rgba(39,174,96,0.15); border-radius: 15px; padding: 25px; margin: 30px 0; border-left: 6px solid var(--success); }
        .example-list { list-style: none; padding: 0; }
        .example-list li { padding: 10px; margin-bottom: 8px; background: rgba(255,255,255,0.05); border-radius: 8px; border-left: 3px solid var(--secondary); }

        /* ========== NUEVOS ESTILOS PARA PROGRESO Y MODAL ========== */
        /* Barra de progreso general */
        .progress-section {
            display: flex;
            align-items: center;
            gap: 20px;
            margin: 20px 0 30px 0;
            flex-wrap: wrap;
        }
        .progress-text {
            font-size: 1.2rem;
            font-weight: 600;
        }
        .progress-bar-container {
            flex: 1;
            height: 20px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            overflow: hidden;
            min-width: 200px;
        }
        .progress-bar-fill {
            height: 100%;
            background: var(--success);
            width: 0%;
            transition: width 0.3s;
        }

        /* Grid de verbos */
        .verb-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 15px; margin: 20px 0; }
        .verb-card { background: var(--verb-card-bg); border-radius: 12px; padding: 15px; border: 1px solid var(--border-color); transition: 0.2s; cursor: pointer; position: relative; }
        .verb-card:hover { border-color: var(--secondary); transform: translateY(-3px); }
        .verb-card .infinitive { font-size: 1.3rem; font-weight: 700; color: var(--secondary); }
        .verb-card .translation { color: var(--text-secondary); font-size: 0.9rem; margin: 5px 0; }
        .verb-card .level { display: inline-block; background: var(--warning); color: white; padding: 2px 8px; border-radius: 12px; font-size: 0.8rem; }
        .verb-card .mastered-star {
            position: absolute;
            top: 10px;
            right: 10px;
            color: gold;
            font-size: 1.2rem;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        /* Modal de conjugación */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            animation: fadeIn 0.3s;
        }
        .modal-content {
            position: relative;
            margin: 50px auto;
            width: 90%;
            max-width: 700px;
            background: var(--card-bg);
            border-radius: 20px;
            padding: 25px;
            border: 1px solid var(--border-color);
            max-height: 80vh;
            overflow-y: auto;
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border-color);
        }
        .modal-header h2 {
            font-size: 2rem;
            color: var(--secondary);
        }
        .modal-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 2rem;
            cursor: pointer;
        }
        .modal-close:hover { color: var(--accent); }
        .conjugation-detail table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        .conjugation-detail th, .conjugation-detail td {
            padding: 10px;
            border: 1px solid var(--border-color);
            text-align: left;
        }
        .conjugation-detail th {
            background: rgba(52,152,219,0.2);
        }
        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }
        .mastered-btn {
            background: gold;
            color: #333;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: 0.2s;
        }
        .mastered-btn:hover { background: #ffd700; transform: scale(1.05); }

        /* Ejercicios (ya existían, los dejamos igual) */
        .exercise-container { margin-top: 40px; padding-top: 20px; border-top: 2px solid var(--border-color); }
        .exercise-title { font-size: 1.5rem; margin-bottom: 20px; color: var(--text-primary); }
        .quiz-option { background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 10px; padding: 15px 20px; margin-bottom: 10px; cursor: pointer; transition: 0.2s; }
        .quiz-option:hover { border-color: var(--secondary); background: rgba(52,152,219,0.1); }
        .quiz-option.selected { border-color: var(--success); background: rgba(39,174,96,0.1); }
        .quiz-option.wrong { border-color: var(--accent); background: rgba(231,76,60,0.1); }
        .feedback-message { padding: 15px; border-radius: 10px; margin-top: 15px; display: none; }
        .feedback-correct { background: rgba(39,174,96,0.2); border-left: 5px solid var(--success); display: block; }
        .feedback-incorrect { background: rgba(231,76,60,0.2); border-left: 5px solid var(--accent); display: block; }
        .action-btn { background: linear-gradient(135deg, var(--secondary), #2980b9); color: white; border: none; padding: 12px 30px; border-radius: 8px; font-weight: 600; cursor: pointer; transition: 0.3s; margin: 10px 5px; }
        .action-btn:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(52,152,219,0.3); }
        .action-btn.reset { background: linear-gradient(135deg, #95a5a6, #7f8c8d); }

        /* Footer */
        .footer { margin-top: 60px; padding: 30px; background: var(--header-bg); border-radius: 15px; border-top: 1px solid var(--border-color); text-align: center; }
        .footer-content { display: flex; flex-direction: column; align-items: center; gap: 20px; }
        .footer-content img { max-width: 150px; height: auto; }
        .footer-text p { margin-bottom: 10px; color: var(--text-secondary); font-size: 0.9rem; }
        .footer-links { display: flex; justify-content: center; gap: 20px; flex-wrap: wrap; }
        .footer-links a { color: var(--secondary); text-decoration: none; transition: color 0.3s; }
        .footer-links a:hover { color: var(--text-primary); }

        @media (max-width: 768px) { .container { padding: 15px; } h1 { font-size: 2rem; } .header-content { flex-direction: column; text-align: center; } .theory-nav { flex-direction: column; } .nav-btn { width: 100%; justify-content: center; } .section { padding: 20px; } }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <div class="container">
        <!-- Header (sin cambios) -->
        <header>
            <div class="header-content">
                <div style="flex-grow: 1; text-align: center;">
                    <h1><i class="fas fa-running"></i> Verbotrainer</h1>
                    <p class="subtitle">Entrenamiento completo de conjugación verbal. 40 verbos esenciales A1-B2 con sistema de repaso inteligente.</p>
                </div>
                <div style="display: flex; gap: 12px;">
                    <a href="index.html" class="btn-icon" title="Inicio">
                        <i class="fas fa-home"></i>
                    </a>
                    <button id="themeToggle" class="btn-icon" title="Cambiar tema">
                        <i class="fas fa-moon"></i>
                    </button>
                </div>
            </div>
        </header>

        <!-- Navegación rápida (igual) -->
        <div class="theory-nav">
            <a href="#grundregel" class="nav-btn nav-1"><i class="fas fa-book"></i> Grundregel</a>
            <a href="#prasens" class="nav-btn nav-2"><i class="fas fa-clock"></i> Präsens</a>
            <a href="#perfekt" class="nav-btn nav-3"><i class="fas fa-history"></i> Perfekt</a>
            <a href="#preteritum" class="nav-btn nav-4"><i class="fas fa-hourglass"></i> Präteritum</a>
            <a href="#futur" class="nav-btn nav-5"><i class="fas fa-forward"></i> Futur</a>
            <a href="#habensein" class="nav-btn nav-6"><i class="fas fa-hand"></i> haben/sein</a>
            <a href="#modal" class="nav-btn nav-7"><i class="fas fa-exclamation"></i> Modalverben</a>
            <a href="#praefix" class="nav-btn nav-8"><i class="fas fa-link"></i> Präfixe</a>
            <a href="#reflexiv" class="nav-btn nav-9"><i class="fas fa-sync-alt"></i> Reflexiv</a>
            <a href="#imperativ" class="nav-btn nav-10"><i class="fas fa-bullhorn"></i> Imperativ</a>
        </div>

        <!-- Secciones teóricas (se mantienen igual) -->
               <!-- SECCIONES TEÓRICAS (extraídas de las imágenes, con la estructura que ya usamos) -->
        <!-- Sección 1: Grundregel -->
        <section id="grundregel" class="section section-1">
            <h2 class="section-title"><i class="fas fa-book" style="color: var(--secondary);"></i> Grundregel</h2>
            <div class="rule-box">
                <p><strong>Verb</strong> – drücken Handlungen, Ereignisse oder Zustände aus. Sie haben Formen für verschiedene Zeiten und werden konjugiert → die Endung zeigt die Person.</p>
                <p><strong>Grundform = Infinitiv:</strong> endet auf <span class="highlight">-en</span>, z.B. <em>gehen</em>.</p>
            </div>
        </section>

        <!-- Sección 2: Präsens -->
        <section id="prasens" class="section section-2">
            <h2 class="section-title"><i class="fas fa-clock" style="color: var(--accent);"></i> Präsens</h2>
            <p>Präsens wird genutzt, wenn etwas gerade passiert oder regelmäßig passiert (optional + <em>immer</em>).</p>
            <div class="table-container">
                <table class="conjugation-table">
                    <thead><tr><th></th><th>gehen</th><th>Endung</th></tr></thead>
                    <tbody>
                        <tr><td>ich</td><td>gehe</td><td>-e</td></tr>
                        <tr><td>du</td><td>gehst</td><td>-st</td></tr>
                        <tr><td>er/sie/es</td><td>geht</td><td>-t</td></tr>
                        <tr><td>wir</td><td>gehen</td><td>-en</td></tr>
                        <tr><td>ihr</td><td>geht</td><td>-t</td></tr>
                        <tr><td>sie/Sie</td><td>gehen</td><td>-en</td></tr>
                    </tbody>
                </table>
            </div>
            <div class="tip-box">
                <h3><i class="fas fa-exclamation-triangle"></i> Besonderheiten</h3>
                <ul class="example-list">
                    <li><strong>Endet Verbstamm auf -s, -ss, -ß, -z:</strong> 2. Pers. Sing. (du) → nur -t (du reist, du sitzt).</li>
                    <li><strong>Endet Verbstamm auf -t, -d:</strong> 2./3. Pers. Sing. und 2. Pers. Pl. → -e- zwischen Stamm und Endung: du wartest, er arbeitet, ihr sendet.</li>
                </ul>
            </div>
            <div class="mnemonic-box">
                <h3><i class="fas fa-random"></i> Unregelmäßige Verben im Präsens (Vokalwechsel)</h3>
                <ul class="example-list">
                    <li>laufen → du <strong>läufst</strong>, er <strong>läuft</strong></li>
                    <li>fahren → du <strong>fährst</strong>, er <strong>fährt</strong></li>
                    <li>geben → du <strong>gibst</strong>, er <strong>gibt</strong></li>
                    <li>sehen → du <strong>siehst</strong>, er <strong>sieht</strong></li>
                    <li>essen → du <strong>isst</strong>, er <strong>isst</strong></li>
                    <li>lesen → du <strong>liest</strong>, er <strong>liest</strong></li>
                </ul>
            </div>
        </section>

        <!-- Sección 3: Perfekt -->
        <section id="perfekt" class="section section-3">
            <h2 class="section-title"><i class="fas fa-history" style="color: var(--success);"></i> Perfekt</h2>
            <div class="rule-box">
                <h4>Bildung:</h4>
                <ul>
                    <li><strong>Verben der Orts- oder Zustandsveränderung</strong> (gehen, einschlafen) → konjugierte Form von <em>sein</em> + Partizip II.</li>
                    <li><strong>Alle anderen Verben</strong> → konjugierte Form von <em>haben</em> + Partizip II.</li>
                </ul>
                <p><strong>Beispiele:</strong> Er ist nach Paris gereist. Die Äpfel haben 1,90€ gekostet. Ich bin zu spät gekommen.</p>
                <p><em>Beachte:</em> Die meisten Verben, die <em>sein</em> verlangen, sind unregelmäßig.</p>
            </div>
            <div class="tip-box">
                <h4>Bildung Partizip II</h4>
                <ul>
                    <li><strong>Regelmäßige Verben:</strong> ge- + Infinitiv (ohne -en) + t / -et (hören → gehört, kosten → gekostet)</li>
                    <li><strong>Unregelmäßige:</strong> ge- + Verbstamm + -en (fahren → gefahren)</li>
                    <li><strong>Trennbare:</strong> Präfix + ge- + Inf. (ohne -en) + t (vorstellen → vorgestellt)</li>
                    <li><strong>Untrennbare:</strong> Präfix + Inf. (ohne -en) + t (verletzen → verletzt)</li>
                </ul>
            </div>
        </section>

        <!-- Sección 4: Präteritum -->
        <section id="preteritum" class="section section-4">
            <h2 class="section-title"><i class="fas fa-hourglass" style="color: var(--warning);"></i> Präteritum</h2>
            <p>Präteritum (pretérito) se usa poco en alemán hablado; es más común en textos escritos.</p>
            <div class="table-container">
                <table class="conjugation-table">
                    <thead><tr><th>Person</th><th>lernen</th></tr></thead>
                    <tbody>
                        <tr><td>ich</td><td>lernte</td></tr>
                        <tr><td>du</td><td>lerntest</td></tr>
                        <tr><td>er/sie/es</td><td>lernte</td></tr>
                        <tr><td>wir</td><td>lernten</td></tr>
                        <tr><td>ihr</td><td>lerntet</td></tr>
                        <tr><td>sie/Sie</td><td>lernten</td></tr>
                    </tbody>
                </table>
                <p><strong>Bildung:</strong> Präsensstamm + t + Personalendung im Präteritum.</p>
            </div>
        </section>

        <!-- Sección 5: Futur -->
        <section id="futur" class="section section-5">
            <h2 class="section-title"><i class="fas fa-forward" style="color: var(--purple);"></i> Futur</h2>
            <ul>
                <li><strong>Präsens + Temporaladverb</strong> (später, morgen) – más común en habla cotidiana.</li>
                <li><strong>Futur I:</strong> konjugierte Form von <em>werden</em> + Infinitiv – expresa algo que sucederá con seguridad.</li>
            </ul>
            <p><strong>Ejemplo:</strong> Jens geht morgen mit Martina ins Kino. = Jens wird morgen mit Martina ins Kino gehen.</p>
        </section>

        <!-- Sección 6: haben und sein -->
        <section id="habensein" class="section section-6">
            <h2 class="section-title"><i class="fas fa-hand" style="color: var(--orange);"></i> haben und sein</h2>
            <div class="table-container">
                <table class="conjugation-table">
                    <thead><tr><th></th><th>Präsens</th><th>Präteritum</th></tr></thead>
                    <tbody>
                        <tr><td>ich</td><td>habe / bin</td><td>hatte / war</td></tr>
                        <tr><td>du</td><td>hast / bist</td><td>hattest / warst</td></tr>
                        <tr><td>er/sie/es</td><td>hat / ist</td><td>hatte / war</td></tr>
                        <tr><td>wir</td><td>haben / sind</td><td>hatten / waren</td></tr>
                        <tr><td>ihr</td><td>habt / seid</td><td>hattet / wart</td></tr>
                        <tr><td>sie/Sie</td><td>haben / sind</td><td>hatten / waren</td></tr>
                    </tbody>
                </table>
            </div>
            <p><strong>Perfekt:</strong> ich habe gehabt / ich bin gewesen.</p>
        </section>

        <!-- Sección 7: Modalverben -->
        <section id="modal" class="section section-7">
            <h2 class="section-title"><i class="fas fa-exclamation" style="color: var(--teal);"></i> Modalverben</h2>
            <ul>
                <li><strong>müssen</strong> → obligación, necesidad</li>
                <li><strong>sollen</strong> → obligación, consejo</li>
                <li><strong>wollen</strong> → deseo</li>
                <li><strong>können</strong> → posibilidad, habilidad</li>
                <li><strong>dürfen</strong> → permiso</li>
                <li><strong>nicht dürfen</strong> → prohibición</li>
            </ul>
            <p><strong>Besonderheit:</strong> 1. y 3. Pers. Sing. no tienen terminación en Präsens; cambian la vocal (excepto sollen).</p>
            <p><strong>Wortstellung:</strong> Aussagesatz: verbo conjugado en 2ª posición; Nebensatz: al final.</p>
            <p><em>Ejemplo:</em> Sie muss ihren Chef anrufen. Ich denke, dass wir uns morgen treffen wollen.</p>
        </section>

        <!-- Sección 8: Verben mit Präfix -->
        <section id="praefix" class="section section-8">
            <h2 class="section-title"><i class="fas fa-link" style="color: var(--primary);"></i> Verben mit Präfix</h2>
            <ul>
                <li><strong>Trennbare Verben:</strong> el prefijo se separa y va al final (an-, auf-, mit-, vor-). Ej.: Sabine <strong>nimmt</strong> Stefan mit. Ich <strong>komme</strong> um 19.15 Uhr an.</li>
                <li><strong>Untrennbare Verben:</strong> el prefijo no se separa (be-, ge-, er-, ver-, ent-). Ej.: Er <strong>verletzt</strong> sich.</li>
            </ul>
            <p><strong>Achtung:</strong> El prefijo de los verbos separables siempre se acentúa. Esto influye en la formación del Partizip II (→ ge- entre prefijo y raíz).</p>
        </section>

        <!-- Sección 9: Reflexive Verben -->
        <section id="reflexiv" class="section section-9">
            <h2 class="section-title"><i class="fas fa-sync-alt" style="color: var(--accent);"></i> Reflexive Verben</h2>
            <div class="table-container">
                <table class="conjugation-table">
                    <thead><tr><th>Personalpronomen</th><th>Reflexivpronomen (Akk.)</th></tr></thead>
                    <tbody>
                        <tr><td>ich</td><td>mich</td></tr>
                        <tr><td>du</td><td>dich</td></tr>
                        <tr><td>er/sie/es</td><td>sich</td></tr>
                        <tr><td>wir</td><td>uns</td></tr>
                        <tr><td>ihr</td><td>euch</td></tr>
                        <tr><td>sie/Sie</td><td>sich</td></tr>
                    </tbody>
                </table>
            </div>
            <p><strong>Ejemplos:</strong> Ich wasche <strong>mich</strong>. (reflexivo) – Ich wasche <strong>dich</strong>. (no reflexivo) – Ich wasche meine Wäsche. (no reflexivo).</p>
        </section>

        <!-- Sección 10: Imperativ -->
        <section id="imperativ" class="section section-10">
            <h2 class="section-title"><i class="fas fa-bullhorn" style="color: var(--success);"></i> Imperativ</h2>
            <div class="table-container">
                <table class="conjugation-table">
                    <thead><tr><th>Forma</th><th>Aussagesatz</th><th>Imperativ</th></tr></thead>
                    <tbody>
                        <tr><td>informell du</td><td>Du nimmst Platz.</td><td>Nimm Platz!</td></tr>
                        <tr><td>informell ihr</td><td>Ihr nehmt Platz.</td><td>Nehmt Platz!</td></tr>
                        <tr><td>formell Sie</td><td>Sie nehmen Platz.</td><td>Nehmen Sie Platz!</td></tr>
                    </tbody>
                </table>
            </div>
            <p><strong>Bildung:</strong> Singular: 2. Pers. Sing. sin -st (du kommst → komm!). Plural informal = 2. Pers. Pl., formal = Infinitiv.</p>
            <p><strong>Wortstellung:</strong> Verbo en primera posición. En la forma formal, el pronombre <em>Sie</em> va detrás del verbo.</p>
        </section>
        <!-- ========== NUEVA SECCIÓN DE PROGRESO ========== -->
        <section class="section" style="border-top-color: var(--purple);">
            <h2 class="section-title"><i class="fas fa-chart-line"></i> Tu progreso en verbos</h2>
            <div class="progress-section">
                <div class="progress-text">
                    <span id="masteredCount">0</span> / <span id="totalVerbs">100</span> verbos dominados
                </div>
                <div class="progress-bar-container">
                    <div id="progressBarFill" class="progress-bar-fill" style="width: 0%;"></div>
                </div>
            </div>
        </section>

        <!-- LISTA DE 100 VERBOS (con estrellas y modal) -->
        <section class="section" style="border-top-color: var(--purple);">
            <h2 class="section-title"><i class="fas fa-list"></i> 40 Verbos esenciales</h2>
            <div id="verbList" class="verb-grid">
                <!-- Se llena con JS -->
            </div>
        </section>

        <!-- EJERCICIO INTERACTIVO (se mantiene, pero mejoraremos la selección) -->
        <section class="section" style="border-top-color: var(--success);">
            <h2 class="section-title"><i class="fas fa-puzzle-piece"></i> Práctica de conjugación</h2>
            <div id="exerciseArea">
                <p id="questionText">Cargando ejercicio...</p>
                <div id="optionsContainer"></div>
                <button class="action-btn" onclick="checkExercise()">Comprobar</button>
                <button class="action-btn reset" onclick="nextExercise()">Siguiente</button>
                <div id="exerciseFeedback" class="feedback-message"></div>
            </div>
        </section>

        <!-- FOOTER (igual) -->
        <footer class="footer">
            <div class="footer-content">
                <img src="images/Logo5.png" alt="DEULCHALEX Logo" width="10%" height="10%" onerror="this.style.display='none'; this.parentElement.innerHTML += '<div style=\'color:var(--secondary); font-size:1.5rem; font-weight:bold;\'>DEULCHALEX</div>';">
                <div class="footer-text">
                    <p>© 2024 DEULCHALEX – Centro de Aprendizaje de Alemán • Para hispanohablantes (Niveles A1–C1)</p>
                    <p>Todos los derechos de contenido educativo pertenecen a DEULCHALEX. Plataforma con fines educativos.</p>
                </div>
                <div class="footer-links">
                    <a href="#"><i class="fas fa-info-circle"></i> Acerca de DEULCHALEX</a>
                    <a href="#"><i class="fas fa-lightbulb"></i> Consejos de aprendizaje</a>
                    <a href="#"><i class="fas fa-question-circle"></i> Preguntas frecuentes</a>
                    <a href="#"><i class="fas fa-envelope"></i> Contacto</a>
                </div>
            </div>
        </footer>
    </div>

    <!-- MODAL DE CONJUGACIÓN (nuevo) -->
    <div id="conjugationModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalVerbTitle">Verbo</h2>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div id="modalVerbContent" class="conjugation-detail">
                <!-- Se rellena con JS -->
            </div>
            <div class="modal-footer">
                <button id="masteredToggleBtn" class="mastered-btn" onclick="toggleMastered()">
                    <i class="fas fa-star"></i> Marcar como aprendido
                </button>
                <button class="action-btn" onclick="closeModal()">Cerrar</button>
            </div>
        </div>
    </div>

    <script>
        // ========== CONFIGURACIÓN SUPABASE ==========
        const supabaseUrl = 'https://kcfiacdwufadnuknkfkp.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtjZmlhY2R3dWZhZG51a25rZmtwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzIxOTA5MTksImV4cCI6MjA4Nzc2NjkxOX0.bmz4K7E-a2PCM5CObDYz9ritbTKLi_OpwyiNBMOH5fU';
        const supabaseClient = window.supabase.createClient(supabaseUrl, supabaseKey);
        const USER_ID = '00000000-0000-0000-0000-000000000000';

        let verbs = [];
        let userVerbsProgress = [];
        let currentExercise = null;
        let currentVerbIdForModal = null; // Para el modal

        // ========== 40 VERBOS ESENCIALES (insertados si no existen) ==========
        const defaultVerbs = [ /* ... mantén aquí la lista completa de 100 verbos que ya tenías ... */ ];

        // ========== FUNCIONES PRINCIPALES ==========
        async function loadVerbs() {
            let { data, error } = await supabaseClient.from('verbs').select('*').order('id');
            if (error || !data || data.length === 0) {
                console.log('Tabla verbs vacía, insertando datos por defecto...');
                for (let i = 0; i < defaultVerbs.length; i += 20) {
                    await supabaseClient.from('verbs').insert(defaultVerbs.slice(i, i+20));
                }
                ({ data, error } = await supabaseClient.from('verbs').select('*').order('id'));
            }
            verbs = data || [];
            await loadUserProgress();
            renderVerbList();
            updateProgressBar();
        }

        // Cargar progreso del usuario
        async function loadUserProgress() {
            const { data, error } = await supabaseClient
                .from('user_verbs')
                .select('*')
                .eq('user_id', USER_ID);
            if (error) console.error('Error cargando progreso', error);
            else userVerbsProgress = data || [];
        }

        // Actualizar barra de progreso
        function updateProgressBar() {
            const mastered = userVerbsProgress.filter(p => p.mastered).length;
            document.getElementById('masteredCount').textContent = mastered;
            const total = verbs.length;
            document.getElementById('totalVerbs').textContent = total;
            const percent = total > 0 ? (mastered / total) * 100 : 0;
            document.getElementById('progressBarFill').style.width = percent + '%';
        }

        // Renderizar lista de verbos con estrellas
        function renderVerbList() {
            const container = document.getElementById('verbList');
            if (!container) return;
            container.innerHTML = verbs.map(v => {
                const progreso = userVerbsProgress.find(p => p.verb_id === v.id);
                const mastered = progreso?.mastered || false;
                return `
                    <div class="verb-card" onclick="showVerbDetail(${v.id})">
                        <div class="infinitive">${v.infinitive}</div>
                        <div class="translation">${v.translation}</div>
                        <span class="level">${v.level || 'A2'}</span>
                        ${mastered ? '<span class="mastered-star">★</span>' : ''}
                    </div>
                `;
            }).join('');
        }

        // Mostrar modal con conjugación completa
        window.showVerbDetail = async function(id) {
            const v = verbs.find(v => v.id === id);
            if (!v) return;
            currentVerbIdForModal = id;
            const progreso = userVerbsProgress.find(p => p.verb_id === id);
            const mastered = progreso?.mastered || false;

            // Construir HTML de la tabla de conjugación
            const futI = `werde ${v.infinitive}`, futDu = `wirst ${v.infinitive}`, futEr = `wird ${v.infinitive}`, 
                  futWir = `werden ${v.infinitive}`, futIhr = `werdet ${v.infinitive}`, futSie = `werden ${v.infinitive}`;
            const modalContent = `
                <h3>${v.infinitive} <small style="color:var(--text-secondary)">${v.translation}</small></h3>
                <h4>Präsens</h4>
                <table>
                    <tr><th>ich</th><td>${v.prasens_ich}</td></tr>
                    <tr><th>du</th><td>${v.prasens_du}</td></tr>
                    <tr><th>er/sie/es</th><td>${v.prasens_er}</td></tr>
                    <tr><th>wir</th><td>${v.prasens_wir}</td></tr>
                    <tr><th>ihr</th><td>${v.prasens_ihr}</td></tr>
                    <tr><th>sie/Sie</th><td>${v.prasens_sie}</td></tr>
                </table>
                <h4>Präteritum</h4>
                <table>
                    <tr><th>ich</th><td>${v.praeteritum_ich}</td></tr>
                    <tr><th>du</th><td>${v.praeteritum_ich.replace('ich', 'du') || ''}</td></tr> <!-- simplificado, idealmente tener todas -->
                    <tr><th>er/sie/es</th><td>${v.praeteritum_ich}</td></tr>
                    <tr><th>wir</th><td>${v.praeteritum_ich.replace('ich', 'wir') || ''}</td></tr>
                    <tr><th>ihr</th><td>${v.praeteritum_ich.replace('ich', 'ihr') || ''}</td></tr>
                    <tr><th>sie/Sie</th><td>${v.praeteritum_ich.replace('ich', 'sie') || ''}</td></tr>
                </table>
                <h4>Futur I (werden + Infinitiv)</h4>
                <table>
                    <tr><th>ich</th><td>werde ${v.infinitive}</td></tr>
                    <tr><th>du</th><td>wirst ${v.infinitive}</td></tr>
                    <tr><th>er/sie/es</th><td>wird ${v.infinitive}</td></tr>
                    <tr><th>wir</th><td>werden ${v.infinitive}</td></tr>
                    <tr><th>ihr</th><td>werdet ${v.infinitive}</td></tr>
                    <tr><th>sie/Sie</th><td>werden ${v.infinitive}</td></tr>
                </table>
                <h4>Perfekt</h4>
                <p><strong>Partizip II:</strong> ${v.partizip2} (${v.perfekt_haben_sein})</p>
                <p><strong>Ejemplo:</strong> ${v.beispiel}</p>
            `;
            document.getElementById('modalVerbTitle').innerText = v.infinitive;
            document.getElementById('modalVerbContent').innerHTML = modalContent;
            const toggleBtn = document.getElementById('masteredToggleBtn');
            toggleBtn.innerHTML = mastered ? '<i class="fas fa-star"></i> Quitar de aprendidos' : '<i class="fas fa-star"></i> Marcar como aprendido';
            document.getElementById('conjugationModal').style.display = 'block';
        };

        // Cerrar modal
        window.closeModal = function() {
            document.getElementById('conjugationModal').style.display = 'none';
        };

        // Marcar/desmarcar como aprendido
        window.toggleMastered = async function() {
            if (!currentVerbIdForModal) return;
            const progreso = userVerbsProgress.find(p => p.verb_id === currentVerbIdForModal);
            const nuevoEstado = !(progreso?.mastered || false);
            if (!progreso) {
                // Crear nuevo registro en user_verbs con mastered = true
                await supabaseClient.from('user_verbs').insert([{
                    user_id: USER_ID,
                    verb_id: currentVerbIdForModal,
                    repetitions: 0,
                    interval_days: 1,
                    next_review: new Date().toISOString().split('T')[0],
                    mistakes: 0,
                    mastered: nuevoEstado,
                    last_reviewed: new Date().toISOString().split('T')[0]
                }]);
            } else {
                await supabaseClient.from('user_verbs').update({ mastered: nuevoEstado }).eq('id', progreso.id);
            }
            await loadUserProgress();
            updateProgressBar();
            renderVerbList(); // refrescar estrellas
            showVerbDetail(currentVerbIdForModal); // actualizar modal
        };

        // Ejercicio mejorado: prioriza verbos no dominados
        window.nextExercise = function() {
            if (verbs.length === 0) return;
            // Elige un verbo: 80% de probabilidad de elegir uno no dominado
            const noDominados = verbs.filter(v => !userVerbsProgress.find(p => p.verb_id === v.id && p.mastered));
            let verb;
            if (noDominados.length > 0 && Math.random() < 0.8) {
                verb = noDominados[Math.floor(Math.random() * noDominados.length)];
            } else {
                verb = verbs[Math.floor(Math.random() * verbs.length)];
            }
            // ... resto del código de ejercicio igual que antes ...
            const tipos = ['prasens', 'praeteritum', 'partizip2'];
            const tipo = tipos[Math.floor(Math.random() * tipos.length)];
            let pregunta = '', correcta = '', opciones = [];
            if (tipo === 'prasens') {
                const personas = ['ich', 'du', 'er', 'wir', 'ihr', 'sie'];
                const pers = personas[Math.floor(Math.random() * personas.length)];
                pregunta = `¿Cuál es la forma de ${verb.infinitive} en Präsens para "${pers}"?`;
                correcta = verb[`prasens_${pers}`];
                opciones = personas.map(p => verb[`prasens_${p}`]).filter(v => v);
            } else if (tipo === 'praeteritum') {
                pregunta = `¿Cuál es la forma de Präteritum (ich) de ${verb.infinitive}?`;
                correcta = verb.praeteritum_ich;
                opciones = [verb.praeteritum_ich, verb.prasens_ich, verb.partizip2].filter(v => v);
            } else if (tipo === 'partizip2') {
                pregunta = `¿Cuál es el Partizip II de ${verb.infinitive}?`;
                correcta = verb.partizip2;
                opciones = [verb.partizip2, verb.infinitive, verb.prasens_ich].filter(v => v);
            }
            while (opciones.length < 4) {
                const otro = verbs[Math.floor(Math.random() * verbs.length)];
                let falso;
                if (tipo === 'prasens') falso = otro[`prasens_${pers}`] || otro.prasens_ich;
                else if (tipo === 'praeteritum') falso = otro.praeteritum_ich;
                else falso = otro.partizip2;
                if (!opciones.includes(falso) && falso) opciones.push(falso);
            }
            opciones = opciones.sort(() => 0.5 - Math.random());
            currentExercise = { verb, tipo, pregunta, correcta, opciones };
            mostrarEjercicio();
        };

        function mostrarEjercicio() {
            if (!currentExercise) return;
            document.getElementById('questionText').innerText = currentExercise.pregunta;
            const optsDiv = document.getElementById('optionsContainer');
            optsDiv.innerHTML = currentExercise.opciones.map(op => `
                <div class="quiz-option" onclick="selectExerciseOption(this, '${op.replace(/'/g, "\\'")}')">${op}</div>
            `).join('');
            document.getElementById('exerciseFeedback').style.display = 'none';
        }

        window.selectExerciseOption = function(el, val) {
            document.querySelectorAll('#optionsContainer .quiz-option').forEach(o => o.classList.remove('selected', 'wrong'));
            el.classList.add('selected');
            el.dataset.selected = val;
        };

        window.checkExercise = function() {
            const selected = document.querySelector('#optionsContainer .quiz-option.selected');
            const feedback = document.getElementById('exerciseFeedback');
            if (!selected) {
                feedback.innerHTML = 'Selecciona una opción.';
                feedback.className = 'feedback-message feedback-incorrect';
                return;
            }
            const isCorrect = selected.dataset.selected === currentExercise.correcta;
            if (isCorrect) {
                feedback.innerHTML = '<i class="fas fa-check-circle"></i> ¡Correcto!';
                feedback.className = 'feedback-message feedback-correct';
                selected.classList.add('selected');
                updateVerbProgress(currentExercise.verb.id, true);
            } else {
                feedback.innerHTML = `<i class="fas fa-times-circle"></i> Incorrecto. La respuesta correcta era: ${currentExercise.correcta}`;
                feedback.className = 'feedback-message feedback-incorrect';
                selected.classList.add('wrong');
                updateVerbProgress(currentExercise.verb.id, false);
            }
        };

        async function updateVerbProgress(verbId, correct) {
            const hoy = new Date().toISOString().split('T')[0];
            const progreso = userVerbsProgress.find(p => p.verb_id === verbId);
            if (!progreso) {
                const nuevo = {
                    user_id: USER_ID,
                    verb_id: verbId,
                    repetitions: correct ? 1 : 0,
                    interval_days: correct ? 2 : 1,
                    next_review: correct ? sumarDias(hoy,2) : sumarDias(hoy,1),
                    mistakes: correct ? 0 : 1,
                    mastered: false,
                    last_reviewed: hoy
                };
                await supabaseClient.from('user_verbs').insert([nuevo]);
            } else {
                let nuevasReps = progreso.repetitions + (correct ? 1 : 0);
                let nuevoIntervalo = correct ? progreso.interval_days * 2 : 1;
                let mastered = progreso.mastered;
                if (!mastered && (nuevasReps >= 5 || nuevoIntervalo > 30)) mastered = true;
                await supabaseClient
                    .from('user_verbs')
                    .update({
                        repetitions: nuevasReps,
                        interval_days: nuevoIntervalo,
                        next_review: sumarDias(hoy, nuevoIntervalo),
                        mistakes: progreso.mistakes + (correct ? 0 : 1),
                        mastered,
                        last_reviewed: hoy
                    })
                    .eq('id', progreso.id);
            }
            await loadUserProgress();
            renderVerbList();
            updateProgressBar();
        }

        function sumarDias(fecha, dias) {
            const d = new Date(fecha);
            d.setDate(d.getDate() + dias);
            return d.toISOString().split('T')[0];
        }

        // Tema claro/oscuro (igual)
        const themeToggle = document.getElementById('themeToggle');
        const themeIcon = themeToggle.querySelector('i');
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'light') {
            document.body.classList.add('light-theme');
            themeIcon.className = 'fas fa-sun';
        } else {
            themeIcon.className = 'fas fa-moon';
        }
        themeToggle.addEventListener('click', () => {
            document.body.classList.toggle('light-theme');
            const isLight = document.body.classList.contains('light-theme');
            localStorage.setItem('theme', isLight ? 'light' : 'dark');
            themeIcon.className = isLight ? 'fas fa-sun' : 'fas fa-moon';
        });

        // Inicio
        document.addEventListener('DOMContentLoaded', async () => {
            await loadVerbs();
            nextExercise();
        });
    </script>
</body>
</html>